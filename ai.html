<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Funfu AI Chat</title>
<script type="module" src="navbar.js"></script>
<!-- Load Puter.ai first -->
<script src="https://js.puter.com/v2/"></script>
<script type="module">
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

onAuthStateChanged(getAuth(), user => {
  if(!user) return; // navbar.js handles redirect

  const form = document.getElementById('chat-form');
  const input = document.getElementById('chat-input');
  const output = document.getElementById('chat-output');

  form.addEventListener('submit', async e => {
    e.preventDefault();
    const question = input.value.trim();
    if(!question) return;

    // Display user question
    output.innerHTML += `<p><b>You:</b> ${question}</p>`;
    input.value = "";

    // Make sure Puter is loaded
    if(!window.puter) {
      output.innerHTML += `<p><b>AI:</b> Puter.ai not loaded yet.</p>`;
      return;
    }

    try {
      const response = await window.puter.ai.chat(question, { model: "gpt-5-nano" });
      output.innerHTML += `<p><b>AI:</b> ${response}</p>`;
      output.scrollTop = output.scrollHeight;
    } catch(err) {
      output.innerHTML += `<p><b>AI:</b> Error: ${err.message}</p>`;
    }
  });
});
</script>
<style>
body {font-family:Arial,sans-serif;margin:0;background:#f9f9f9;}
main {padding:20px;}
#chat-output {border:1px solid #ccc;height:300px;overflow-y:auto;padding:10px;background:#fff;margin-bottom:10px;border-radius:4px;}
#chat-input {width:calc(100% - 100px);padding:10px;font-size:14px;}
button {padding:10px;width:80px;background:#0a59a6;color:white;border:none;border-radius:4px;cursor:pointer;}
button:hover {background:#094a86;}
form {display:flex;gap:10px;}
</style>
</head>
<body>
<main>
  <h2>Funfu AI Chat</h2>
  <div id="chat-output"></div>
  <form id="chat-form">
    <input id="chat-input" placeholder="Ask something..." required>
    <button type="submit">Send</button>
  </form>
</main>
</body>
</html>
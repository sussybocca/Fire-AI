<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>One-Click Site Deploy</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  input, button, textarea { width: 100%; max-width: 500px; padding: 10px; margin: 5px 0; }
  iframe { width: 100%; height: 400px; border: 1px solid #ccc; margin-top: 20px; }
  #status { margin-top: 10px; font-weight: bold; color: green; }
  #error { margin-top: 10px; font-weight: bold; color: red; }
</style>
</head>
<body>
<h1>One-Click Site Deploy (Frontend-Only)</h1>

<h3>Step 1: GitHub Repo Initialization</h3>
<input type="text" id="githubToken" placeholder="GitHub Personal Access Token">
<input type="text" id="repoName" placeholder="New Repo Name">
<button onclick="createGitHubRepo()">Initialize Repo</button>

<h3>Step 2: Netlify Deployment</h3>
<input type="text" id="netlifyToken" placeholder="Netlify Personal Access Token">
<textarea id="siteHTML" placeholder="Paste your HTML here"></textarea>
<button onclick="deployToNetlify()">Run & Deploy</button>

<div id="status"></div>
<div id="error"></div>
<iframe id="preview"></iframe>

<script>
async function createGitHubRepo() {
  const token = document.getElementById('githubToken').value.trim();
  const repoName = document.getElementById('repoName').value.trim();
  const status = document.getElementById('status');
  const error = document.getElementById('error');
  status.textContent = '';
  error.textContent = '';

  if(!token || !repoName) {
    error.textContent = 'GitHub token and repo name are required.';
    return;
  }

  try {
    const response = await fetch('https://api.github.com/user/repos', {
      method: 'POST',
      headers: {
        'Authorization': `token ${token}`,
        'Accept': 'application/vnd.github.v3+json'
      },
      body: JSON.stringify({ name: repoName, private: false })
    });

    if(!response.ok) throw new Error('Failed to create repo. Check token and repo name.');

    const data = await response.json();
    status.textContent = `GitHub repo created: ${data.full_name}`;
  } catch(e) {
    error.textContent = e.message;
  }
}

async function deployToNetlify() {
  const netlifyToken = document.getElementById('netlifyToken').value.trim();
  const html = document.getElementById('siteHTML').value;
  const status = document.getElementById('status');
  const error = document.getElementById('error');
  const preview = document.getElementById('preview');
  status.textContent = '';
  error.textContent = '';

  if(!netlifyToken || !html) {
    error.textContent = 'Netlify token and site HTML are required.';
    return;
  }

  try {
    status.textContent = 'Deploying to Netlify...';

    // Create a new site
    const createSite = await fetch('https://api.netlify.com/api/v1/sites', {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${netlifyToken}` }
    });

    const siteData = await createSite.json();
    const siteId = siteData.id;

    if(!siteId) throw new Error('Failed to create Netlify site.');

    // Prepare a zip file with the HTML
    const zip = new JSZip();
    zip.file('index.html', html);
    const zipBlob = await zip.generateAsync({ type: 'blob' });

    // Upload the zip to deploy
    const formData = new FormData();
    formData.append('file', zipBlob, 'site.zip');

    const deployResp = await fetch(`https://api.netlify.com/api/v1/sites/${siteId}/deploys`, {
      method: 'POST',
      headers: { 'Authorization': `Bearer ${netlifyToken}` },
      body: zipBlob
    });

    const deployData = await deployResp.json();

    if(deployData.url) {
      status.textContent = `Site deployed: ${deployData.url}`;
      preview.src = deployData.url;
    } else {
      throw new Error('Deployment failed');
    }

  } catch(e) {
    error.textContent = e.message;
  }
}

// JSZip library for creating zip files in browser
const script = document.createElement('script');
script.src = "https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js";
document.head.appendChild(script);
</script>
</body>
</html>
